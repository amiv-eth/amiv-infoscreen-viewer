<!DOCTYPE html>
<html lang="en" style="height=1080px; width:1920px">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>AMIV Infoscreen</title>

    <!-- Bootstrap -->
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="style.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" type="text/JavaScript"></script>
    <script src="https://rawgit.com/amiv-eth/amiv-jsclient/master/amivaccess.js" type="text/JavaScript"></script>
    
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body style="background-color:white; height:1080px; width:1920px; font-family: DINPro">
    <div class="indextitel" >
      
        <img src="logo.png" alt="AMIV logo" style="display: block; margin:12px auto auto 100px; max-height:80%; max-width:80%; left: 100px; right:auto; top:12px;bottom:auto; position:absolut"></img>      
    </div>     <!--<div class="col-md-6" style="height:920px">-->
      
    <div id="bemerkungen">
      <div id="Event0">
        <div class="eintrag">
          <div class="panel panel-primary">
            <div class="panel-heading">
            </div>
            <div class="panel-body" >
            </div>
          </div>
        </div>
      </div>
      <div id="Event1">
        <div class="eintrag">
          <div class="panel panel-default">
            <div class="panel-heading">
            </div>
            <div class="panel-body" >
            </div>
          </div>
        </div>
      </div>
      <div id="Event2">
        <div class="eintrag">
          <div class="panel panel-default">
            <div class="panel-heading">
            </div>
            <div class="panel-body" >
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="bilderRahmen">
      <div class="Hintergrund">
      </div>
      <div class="HintergrundText">
      </div>
    </div>
    <div class="untererRahmen">
      <div id="textUnten">
        <p>
          Für mehr Information: www.amiv.ethz.ch
        </p>
      </div>
    </div>
    
    <script type="text/JavaScript">
      var eventsListe=amivaccess.events.GET({where:["show_infoscreen==true"]});
      eventsListe = eventsListe['_items'];
      console.log(eventsListe);
      var actualDate=new Date();
      var atag=actualDate.getDate();
      var amonat=actualDate.getMonth();
      var tempeventsListe=eventsListe;
      console.log(tempeventsListe);
      var apilink="https://amiv-apidev.vsos.ethz.ch";
      eventsListe=[];
       for (var j = 0; j<tempeventsListe.length; j++){
        if(tempeventsListe[j]['time_start']!=null){
        var tag=tempeventsListe[j]['time_start'].slice(8,10);
        if(tempeventsListe[j]['time_start'][5]==0){
        var monat=parseInt(tempeventsListe[j]['time_start'].slice(6,7))-1;}
        else{
          var monat=parseInt(tempeventsListe[j]['time_start'].slice(5,7))-1;
        };
      };
        if((tag>atag || monat>=amonat) && tempeventsListe[j]['time_start']!=null)
          {
            eventsListe.push(tempeventsListe[j]);
          };
        };
        console.log(eventsListe);
        

      var poster = [];
      var month = new Array();
        month[0] = "January";
        month[1] = "February";
        month[2] = "March";
        month[3] = "April";
        month[4] = "May";
        month[5] = "June";
        month[6] = "July";
        month[7] = "August";
        month[8] = "September";
        month[9] = "October";
        month[10] = "November";
        month[11] = "December";
      var   monthD = new Array();
        monthD[0] = "Januar";
        monthD[1] = "Februar";
        monthD[2] = "März";
        monthD[3] = "April";
        monthD[4] = "Mai";
        monthD[5] = "Juni";
        monthD[6] = "Juli";
        monthD[7] = "August";
        monthD[8] = "September";
        monthD[9] = "Oktober";
        monthD[10] = "November";
        monthD[11] = "Dezember";
      for (var i = 0; i<3; i++){
        var tag=eventsListe[i]['time_start'].slice(8,10);
        if(eventsListe[i]['time_start'][5]==0){
        var monat=parseInt(eventsListe[i]['time_start'].slice(6,7))-1;}
        else{
          var monat=parseInt(eventsListe[i]['time_start'].slice(5,7))-1;
        };
        var jahr=eventsListe[i]['time_start'].slice(0,4);
      if(eventsListe[i]['title_de']!=null){
        $('.panel-heading').eq(i).append('<h2>'+eventsListe[i]['title_de']+'</h2>');
        var wo="Wo: ";
        var wann="Wann: ";
        var frei="Frei Plätze: ";
        var anmeldungNo="Keine Anmeldung";
        var anmeldungYes="Anmeldung: www.amiv.ethz.ch";
        var titel=eventsListe[i]['title_de'];
        var n = monthD[monat];
        var time=tag+". "+n+" "+jahr;
      }else{
        $('.panel-heading').eq(i).append('<h2>'+eventsListe[i]['title_en']+'</h2>');
        var wo="Where: ";
        var wann="When: ";
        var frei="Empty spaces: ";
        var anmeldungNo="No registration";
        var anmeldungYes="Registration: www.amiv.ethz.ch";
        var titel=eventsListe[i]['title_en'];
        var n = month[monat];
        var time=n+" "+tag+" "+jahr;
      };
      if(eventsListe[i]['location']!=null){
        $('.panel-body').eq(i).append('<div class="wo">'+wo+eventsListe[i]['location']+'</div>');
      };
        $('.panel-body').eq(i).append('<div class="wann">'+wann+time+'</div>');
      if(eventsListe[i]['spots']==-1){
        $('.panel-body').eq(i).append('<div class="anmeldung">'+anmeldungNo+'</div>');
      }else{
        $('.panel-body').eq(i).append('<div class="anmeldung">'+anmeldungYes+'</div>');
      };
      if(eventsListe[i]['spots']!=-1){
        $('.panel-body').eq(i).append('<div class="freiePlaetze">'+frei+((eventsListe[i]['spots'])-(eventsListe[i]['signup_count']))+'</div>');
      };
      if(eventsListe[i]['img_infoscreen']!=null && eventsListe[i]['img_infoscreen']['content_url']!=null){
      poster[i]=eventsListe[i]['img_infoscreen']['content_url'];}
      else{
        poster[i]=null;
      };
    };
      if(poster[0]!=null){
        $('.Hintergrund').css('background-image', 'url("'+apilink+poster[0]+'")');}
        else{
        $('.Hintergrund').css('background-image', 'url("LOGO_FINAL_NO_TEXT.svg")');
        $('.Hintergrund').css('opacity', '0.2');
        $('.HintergrundText').append('<h1>'+titel+'</h1><p>'+time+'</p>');
        if(eventsListe[0]['location']!=null){
        $('.HintergrundText').append('<p>'+eventsListe[0]['location']+'</p>');
        };
      };
      var curPic = 1;
      var prev=0;
      var timerIndex = setInterval(function(){ setImg() }, 1000);
      function setImg(){        
        var now = "Event"+curPic;
        var first = "Event"+prev;
        document.getElementById(first).innerHTML = document.getElementById(first).innerHTML.replace("panel-primary","panel-default");
        document.getElementById(now).innerHTML = document.getElementById(now).innerHTML.replace("panel-default","panel-primary");
      if(poster[curPic]!=null){
        $('.Hintergrund').css('background-image', 'url("'+apilink+poster[curPic]+'")');
        $('.Hintergrund').css('opacity', '1');
        $('.HintergrundText').html("");
      }else{
        $('.Hintergrund').css('background-image', 'url("LOGO_FINAL_NO_TEXT.svg")');
        $('.Hintergrund').css('opacity', '0.2');
        $('.HintergrundText').append('<h1>'+titel+'</h1><p>'+time+'</p>');
        if(eventsListe[curPic]['location']!=null){
        $('.HintergrundText').append('<p>'+eventsListe[curPic]['location']+'</p>');
        };
      };
      if(curPic < ((poster.length)-1)){
          curPic++;
          prev=curPic-1;}
        else{
          curPic = 0;
          prev=(poster.length)-1;};
      };     

    </script>
    
  </body>
</html>
